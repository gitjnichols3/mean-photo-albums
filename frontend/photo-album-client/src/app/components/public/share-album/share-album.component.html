<div class="album-details">
  <!-- Shared album view (read only) -->
  <div *ngIf="isLoading" class="loading">
    Loading album...
  </div>

  <p *ngIf="!isLoading && errorMessage" class="error">
    {{ errorMessage }}
  </p>

  <ng-container *ngIf="!isLoading && album; else noAlbum">
    <header class="album-header">
      <h2 class="album-title">{{ album.title }}</h2>
      <p *ngIf="album.description" class="album-description">
        {{ album.description }}
      </p>
      <p class="hint">
        Shared album view — read only
      </p>
    </header>

    <div class="album-layout">
      <!-- TIMELINE -->
      <section class="timeline">
        <h3 class="section-heading">Event Timeline</h3>

        <div *ngIf="timelineGroups.length === 0" class="empty-state">
          No events defined yet.
        </div>

        <ng-container *ngFor="let group of timelineGroups">
          <h4 class="timeline-date">
            {{ group.dateLabel }}
          </h4>

          <ul class="timeline-list">
            <li
              *ngFor="let ev of group.events"
              [class.selected]="ev.eventId === selectedEventId"
              class="timeline-event"
            >
              <button
                type="button"
                class="timeline-event-main"
                (click)="selectEvent(ev)"
              >
                <span class="timeline-dot"></span>
                <span class="timeline-event-text">
                  <span class="timeline-event-name">
                    {{ ev.name }}
                  </span>
                  <span *ngIf="ev.location" class="timeline-event-meta">
                    {{ ev.location }}
                  </span>
                </span>
              </button>
            </li>
          </ul>
        </ng-container>

        <button
          type="button"
          class="btn-secondary btn-small mt-1"
          (click)="clearEventSelection()"
          *ngIf="unassignedPhotos.length > 0"
        >
          View unassigned photos
        </button>
      </section>

      <!-- PHOTO PANEL -->
      <section class="photo-panel">
        <h3 class="section-heading">
          Photos: {{ selectedEventName }}
        </h3>

        <div
          *ngIf="selectedEventId && selectedEventPhotos.length === 0"
          class="empty-state"
        >
          No photos for this event yet.
        </div>

        <div
          *ngIf="!selectedEventId && unassignedPhotos.length === 0"
          class="empty-state"
        >
          Select an event on the left to view its photos.
        </div>

        <div
          class="photo-grid"
          *ngIf="
            (selectedEventId && selectedEventPhotos.length > 0) ||
            (!selectedEventId && unassignedPhotos.length > 0)
          "
        >
          <figure
            *ngFor="
              let p of selectedEventId ? selectedEventPhotos : unassignedPhotos;
              let i = index
            "
            class="photo-card"
          >
            <img
              [src]="imageBaseUrl + p.originalUrl"
              [alt]="selectedEventId ? selectedEventName : album.title"
              class="photo-thumb"
              (click)="openPhotoViewer(i)"
            />

            <figcaption *ngIf="p.takenAt || p.uploadedAt" class="photo-caption">
              <ng-container *ngIf="p.takenAt; else uploadedDatePublic">
                {{ p.takenAt | date: 'short' }}
              </ng-container>
              <ng-template #uploadedDatePublic>
                Uploaded at: {{ p.uploadedAt | date: 'short' }}
              </ng-template>
            </figcaption>
          </figure>
        </div>
      </section>
    </div>
  </ng-container>

  <ng-template #noAlbum>
    <div *ngIf="!isLoading && !album && !errorMessage" class="empty-state">
      Album not found or no longer shared.
    </div>
  </ng-template>

  <!-- Photo viewer modal (lightbox) -->
  <div
    class="photo-viewer-backdrop"
    *ngIf="isPhotoViewerOpen"
    (click)="closePhotoViewer()"
  ></div>

  <div
    class="photo-viewer-modal"
    *ngIf="isPhotoViewerOpen"
    (click)="$event.stopPropagation()"
  >
    <button
      type="button"
      class="photo-viewer-close"
      (click)="closePhotoViewer()"
    >
      ×
    </button>

    <div
      *ngIf="currentViewerPhoto as photo"
      class="photo-viewer-body"
    >
      <button
        type="button"
        class="viewer-nav viewer-nav-prev"
        (click)="$event.stopPropagation(); prevViewerPhoto()"
      >
        ‹
      </button>

      <div class="photo-viewer-image-wrapper">
        <img
          [src]="imageBaseUrl + photo.originalUrl"
          [alt]="selectedEventId ? selectedEventName : album?.title"
          class="photo-viewer-image"
        />

        <p class="photo-viewer-caption">
          Photo {{ viewerIndex + 1 }} of {{ viewerPhotos.length }}
          <span *ngIf="selectedEventId">
            • {{ selectedEventName }}
          </span>
          <span *ngIf="photo.takenAt || photo.uploadedAt">
            •
            <ng-container *ngIf="photo.takenAt; else uploadedDateViewerPublic">
              {{ photo.takenAt | date: 'short' }}
            </ng-container>
            <ng-template #uploadedDateViewerPublic>
              Uploaded at: {{ photo.uploadedAt | date: 'short' }}
            </ng-template>
          </span>
        </p>
      </div>

      <button
        type="button"
        class="viewer-nav viewer-nav-next"
        (click)="$event.stopPropagation(); nextViewerPhoto()"
      >
        ›
      </button>

      <div class="photo-viewer-hint">
        ← → to navigate • Esc to close
      </div>
    </div>
  </div>
</div>
