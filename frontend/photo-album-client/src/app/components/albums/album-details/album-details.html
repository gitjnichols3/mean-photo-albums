<button type="button" (click)="goBack()">
  ← Back to Albums
</button>

<p *ngIf="errorMessage" class="error">
  {{ errorMessage }}
</p>

<ng-container *ngIf="album$ | async as album; else loading">
  <ng-container *ngIf="album; else notFound">
    <h2>{{ album.title }}</h2>

    <p *ngIf="album.description">
      {{ album.description }}
    </p>

    <p>Album ID: {{ album._id }}</p>
    <p>Events: {{ album.events && album.events.length || 0 }}</p>

    <hr />

    <!-- Events list -->
    <div *ngIf="album.events && album.events.length > 0; else noEvents">
      <h3>Events</h3>
      <ul>
        <li *ngFor="let ev of album.events">
          <strong>{{ ev.name }}</strong>
          <span *ngIf="ev.startDate">
            — {{ ev.startDate }}
          </span>
          <span *ngIf="ev.location">
            — {{ ev.location }}
          </span>
        </li>
      </ul>
    </div>

    <ng-template #noEvents>
      <p>This album has no events yet.</p>
    </ng-template>

    <hr />

    <h3>Add a new event</h3>

    <form (ngSubmit)="addEvent(album)" #eventForm="ngForm" novalidate>
      <div>
        <label for="eventName">Name</label>
        <input
          id="eventName"
          name="eventName"
          type="text"
          required
          [(ngModel)]="newEventName"
        />
      </div>

      <div>
        <label for="eventDate">Start date</label>
        <input
          id="eventDate"
          name="eventDate"
          type="date"
          [(ngModel)]="newEventDate"
        />
      </div>

      <div>
        <label for="eventLocation">Location</label>
        <input
          id="eventLocation"
          name="eventLocation"
          type="text"
          [(ngModel)]="newEventLocation"
        />
      </div>

      <p *ngIf="formError" class="error">
        {{ formError }}
      </p>

      <button type="submit">
        Add event
      </button>
    </form>
  </ng-container>
</ng-container>

<ng-template #loading>
  <p>Loading album details...</p>
</ng-template>

<ng-template #notFound>
  <p>Album not found.</p>
</ng-template>
