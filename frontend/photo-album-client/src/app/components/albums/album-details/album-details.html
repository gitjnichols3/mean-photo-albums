<button type="button" (click)="goBack()" class="btn-back">
  ← Back to Albums
</button>

<p *ngIf="errorMessage" class="error">
  {{ errorMessage }}
</p>

<!-- Main album content -->
<div *ngIf="album as a" class="album-details">
  <header class="album-header">
    <h2 class="album-title">{{ a.title }}</h2>
    <p *ngIf="a.description" class="album-description">
      {{ a.description }}
    </p>
  </header>

  <div class="album-layout">
    <!-- TIMELINE COLUMN -->
    <section class="timeline">
      <h3 class="section-heading">Event Timeline</h3>

      <div *ngIf="timelineGroups.length === 0" class="empty-state">
        No events yet. Add your first event below.
      </div>

      <ng-container *ngFor="let group of timelineGroups">
        <h4 class="timeline-date">
          {{ group.dateLabel }}
        </h4>

        <ul class="timeline-list">
          <li
            *ngFor="let ev of group.events; trackBy: trackEvent"
            [class.selected]="ev.eventId === selectedEventId"
            class="timeline-event"
          >
            <button
              type="button"
              class="timeline-event-main"
              (click)="selectEventForViewing(ev)"
            >
              <span class="timeline-dot"></span>
              <span class="timeline-event-text">
                <span class="timeline-event-name">
                  {{ ev.name }}
                </span>
                <span *ngIf="ev.location" class="timeline-event-meta">
                  {{ ev.location }}
                </span>
              </span>
            </button>

            <button
              type="button"
              class="btn-link btn-delete"
              (click)="deleteEvent(ev)"
            >
              Delete
            </button>
          </li>
        </ul>
      </ng-container>

      <button
        type="button"
        class="btn-secondary btn-small mt-1"
        (click)="clearEventSelection()"
      >
        View unassigned photos
      </button>
    </section>

    <!-- PHOTO COLUMN -->
    <section class="photo-panel">
      <h3 class="section-heading">
        Photos: {{ selectedEventName }}
      </h3>

      <p *ngIf="photoError" class="error">
        {{ photoError }}
      </p>

      <div *ngIf="isLoadingPhotos" class="loading">
        Loading photos...
      </div>

      <div *ngIf="!isLoadingPhotos">
        <div *ngIf="selectedEventId && selectedEventPhotos.length === 0" class="empty-state">
          No photos for this event yet.
        </div>

        <div *ngIf="!selectedEventId && unassignedPhotos.length === 0" class="empty-state">
          No unassigned photos.
        </div>

        <div class="photo-grid">
          <figure
            *ngFor="let p of selectedEventId ? selectedEventPhotos : unassignedPhotos"
            class="photo-card"
          >
            <img
              [src]="imageBaseUrl + p.originalUrl"
              [alt]="selectedEventId ? selectedEventName : a.title"
              class="photo-thumb"
            />
            <button
              type="button"
              class="btn-link btn-delete"
              (click)="deletePhoto(p)"
            >
              Delete
            </button>

            <figcaption *ngIf="p.uploadedAt" class="photo-caption">
              {{ p.uploadedAt | date: 'short' }}
            </figcaption>
          </figure>
        </div>
      </div>

      <!-- Upload form -->
      <form (ngSubmit)="onUploadPhotos($event)" class="photo-upload-form">
        <p class="hint">
          Uploads are attached to the currently selected event.
          If no event is selected, photos will be unassigned.
        </p>

        <div class="form-row">
          <label for="photoFiles" class="form-label">Add photos</label>
          <input
            id="photoFiles"
            type="file"
            multiple
            (change)="onFilesSelected($event)"
          />
        </div>

        <button
          type="submit"
          class="btn-primary"
          [disabled]="isUploading || !selectedFiles"
        >
          {{ isUploading ? 'Uploading…' : 'Upload' }}
        </button>
      </form>
    </section>
  </div>

  <hr class="divider" />

  <!-- ADD EVENT -->
  <section class="add-event-section">
    <h3 class="section-heading">Add a new event</h3>

    <form (ngSubmit)="addEvent()" class="add-event-form">
      <div class="form-row">
        <label for="newName" class="form-label">Name</label>
        <input
          id="newName"
          name="newName"
          type="text"
          [(ngModel)]="newEventName"
          required
        />
      </div>

      <div class="form-row">
        <label for="newDate" class="form-label">Date</label>
        <input
          id="newDate"
          name="newDate"
          type="date"
          [(ngModel)]="newEventDate"
        />
      </div>

      <div class="form-row">
        <label for="newLocation" class="form-label">Location</label>
        <input
          id="newLocation"
          name="newLocation"
          type="text"
          [(ngModel)]="newEventLocation"
        />
      </div>

      <p *ngIf="formError" class="error">
        {{ formError }}
      </p>

      <button type="submit" class="btn-primary">
        Add event
      </button>
    </form>
  </section>
</div>

<!-- Fallback loading state -->
<div *ngIf="!album && !errorMessage" class="loading">
  Loading album details...
</div>
